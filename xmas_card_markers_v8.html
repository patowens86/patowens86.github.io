
<html>

  <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
  <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/cfe5f316/dist/aframe-extras.js"></script>
  <!-- we import arjs version without NFT but with marker + location based support -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
      <script src="https://unpkg.com/merge-images"></script>
    <script src="/scripts/capture-video-frame.js"></script>
  <script src="/scripts/components_v8.js"></script>
  <script src="/jquery.js"></script>
<!--   <script src="https://rawgit.com/mayognaise/aframe-gif-shader/master/dist/aframe-gif-shader.min.js"></script> --> <!--
  <script src="https://rawgit.com/mayognaise/aframe-gif-component/master/dist/aframe-gif-component.min.js"></script> -->


	<head><link rel="stylesheet" href="index.css"></head>


  

<!--   <div class="arjs-loader">
    <div>
      <img id="load-Image" src="graphics/gift-box.gif">
      Loading, please wait...
    </div>
  </div> -->



  <body style="margin : 0px; overflow: hidden;">
<!-- Loading screen -->

  <div class="xload" style="  height: 100vh; text-align: center; padding-top: 150px; background: url('/graphics/loading-head.svg') center top/contain no-repeat;
  background-color: ffffff;z-index: 9999;">
    <div><img id="xload-img" src="/graphics/gift-box.gif" alt="" style="z-index: 9999"></div>
    <div class="xload__bar" style="z-index: 9999">
    <!-- modify these styles to reflect loading progress from 0 to 100% -->
      <span id="xload__bar_progress" style="width: 1%"></span>
    </div>
  </div>
<div id="postload" style="display: none">
  <div id="cursorContainer">

    <div id="scanInstructions">
      <img id="scanCursor" src="graphics/scan.png" id="scanID">
      <p id="scanInstructionText">Scan a <b>gift box</b> to activate a scene.</p>
    </div>
  </div>

	<!-- <div class="arjs-loader">
    	<div>Loading, please wait...</div>
  	</div> -->
  <div id="tapInstructions">
    <img src="assets/ic_tap1x.svg" id="tapIcon">
    <p id="instructionText">Tap a <b>gift box</b> to activate a scene.</p>
  </div>

	<div id="audioIconContainer" style=" z-index: 9999">
	 <div id="audioIcon" class="audioOff" style="z-index: 9999"></div>
	</div>

	<div id="photoModeContainer" style=" z-index: 9999">

	  <div id="photoModeBG"></div>
	  <img id="photoModeImage">
	  <div id="flash"></div>
	  <div id="shutterButton" style="z-index:9999"></div>
	  <div id="closeButton"></div>

	  <div id="photoPrompts">
	      <p id="shareBlurb" style="z-index:11">Tap and hold to save the picture!</span></p>
	      <p id="shareBlurbAlt" style="z-index:11">Tap and hold to save the picture!</p>
	      <div id="shareButton" style="z-index:11">
	        <p id="shareButtonText">Share</p>
	      </div>
	      <div id="retakeButton" style="z-index:11">
	        <p>Retake</p>
	      </div>

	  </div>
    <div id="selfieContainer" style="display: none; z-index: 10">
      <img id="santaSelfie" src='/graphics/SantaSelfie.gif'></div>
    </div>
  </div>

    <div class="xblink">
  <!-- get .xblink__widget as a container, and add .xblink--active to get a blink effect (you can remove and add the class again to start the animation) -->
  <div id="cameraflash" class="xblink__widget"></div>
</div>
      <div class="xdis" style="display: none; z-index: 9999">
      <div class="xdis__widget">
        <div class="xdis__title">Discard Photo?</div>
        <p>If you go back now, you will lose your photo</p>
        <div class="xdis__button">
          <div id="discardButton" class="xm__button xm__button--outline" style="z-index: 9999">Discard</div>
          <div id="keepButton" class="xm__button" style="z-index: 9999">Keep</div>
        </div>
      </div>
    </div>
</div>


<!-- <canvas id="canvas"></canvas> -->
  <a-scene
      vr-mode-ui='enabled: false;'
      toggle-audio
      photo-mode
      renderer="logarithmicDepthBuffer: true;"
      embedded arjs='trackingMethod: best; sourceType: webcam; debugUIEnabled: false;'
      loading-xmas
      >


        <a-assets timeout="20000">
          <a-asset-item id="s1" src="/models/scene1.glb"></a-asset-item>
<!--           <a-asset-item id="s1_obj" src="/models/scene1.obj"></a-asset-item>
          <a-asset-item id="s1_mat" src="/models/scene1.mtl"></a-asset-item> -->
          <a-asset-item id="s1_santa" src="/models/scene1_santa.glb"></a-asset-item>
          <a-asset-item id="s1_sink" src="/models/scene1_sink.glb"></a-asset-item>
          <!-- <a-asset-item id="s1" src="/models/scene1_flipped.glb"></a-asset-item> -->
          <!-- <a-asset-item id="s1" src="/models/scene1.gltf"></a-asset-item> -->
          <a-asset-item id="s3" src="/models/scene3.glb"></a-asset-item>
          <a-asset-item id="s4" src="/models/scene4.glb"></a-asset-item>
          <a-asset-item id="s6" src="/models/scene6.glb"></a-asset-item>
          <a-asset-item id="s11" src="/models/scene11.glb"></a-asset-item>
          <a-asset-item id="s11_phone" src="/models/scene11_phone.glb"></a-asset-item>
          <!-- <a-asset-item id="s11" src="/models/scene11.gltf"></a-asset-item> -->
          <a-asset-item id="gift_1" src="/models/Gift_1.glb"></a-asset-item>
          <a-asset-item id="gift_3" src="/models/Gift_3.glb"></a-asset-item>
          <a-asset-item id="gift_4" src="/models/Gift_4.glb"></a-asset-item>
          <a-asset-item id="gift_6" src="/models/Gift_6.glb"></a-asset-item>
          <a-asset-item id="gift_11" src="/models/Gift_11.glb"></a-asset-item>
          <video id="s3_video" preload="auto" autoplay="true" loop="true" src="/videos/scene3.mp4"></video>
          <audio id="song_file" loop="false" src="/audio/JingleBells_s.mp3"></audio>
   <!--        <img id="santa_selfie" loop="false" src="/graphics/SantaSelfie.gif"> -->
          <!--
          <audio id="s1_audio" autoplay="false" loop="false" src="/audio/scene1.mp3"></sound>
          <audio id="s3_audio" autoplay="false" loop="false" src="/audio/scene2.mp3"></sound>
          <audio id="s4_audio" autoplay="false" loop="false" src="/audio/scene3.mp3"></sound>
          <audio id="s6_audio" autoplay="false" loop="false" src="/audio/scene4.mp3"></sound>
          <audio id="s11_audio" autoplay="false" loop="false" src="/audio/scene5.mp3"></sound> -->
        </a-assets> 



        <a-sound id="song" class="audio" src="#song_file" volume="0"></a-sound> <!--
        <a-sound id="audio_1" class="audio" src="/audio/WeWishYou_s.mp3" autoplay="false" volume="0"></a-sound> -->



        <a-marker preset="custom" type="pattern" url="/markers/1.patt">
            <!-- <a-box position="0 .5 0" start-animation='name: scene1;'>
            </a-box> -->


			  <a-box class="gift" position='0 0.5 0' scale="1.5 1.5 1.5" opacity='0' start-animation='name: scene1; sound_id: audio_1; length: 18000'>
				<a-entity
              	id='box1'
              	scale="0.25 0.25 0.25"
              	position='0 -0.5 0'
                gltf-model='#gift_1'
              	></a-entity>
			  </a-box>
   
              <a-entity class="scene" id='scene1' scale=".65 .65 .65"
              visible="false">
              <a-entity
                id="scene1_santa_model"
                rotation="90 0 0"
                gltf-model="#s1_santa"
                animation__walktocamera="property: position; dur: 1000; from 0 0 0; to: 0 0 4; easing: easeInOutSine; delay: 1500"
                animation__turn_1="property: rotation; to: 90 90 0; easing: easeInOutSine; delay: 7000"
                animation__walktoright="property: position; dur:1000; from: 0 0 4; to: 4 0 4; easing: easeInOutSine; delay: 8000"
                animation__walktosink="property: position; dur:1000; from: 4 0 4; to: 4 0 1; easing: easeInOutSine; delay: 9000"
                animation__turn_2="property: rotation; from: 90 90 0; to: 90 180 0; easing: easeInOutSine; delay: 8500"
                animation__restart="startEvents: scene1_end; property: position; dur: 500; to: 0 0 0; delay 10000;"
                animation-mixer
                >
              </a-entity>

              <a-entity
                  gltf-model='#s1_sink'
                  animation-mixer
                  ></a-entity>
              </a-entity>


          </a-marker>
          <a-marker preset="custom" type="pattern" url="/markers/3.patt">
			  <a-box class="gift" position='0 0.5 0' scale="2 2 2" material='opacity: 0;' start-animation='name: scene3; length: 25000'>
	              <a-entity 
	                gltf-model='#gift_3'
              		scale="0.25 0.25 0.25"
              		position='0 -0.5 0'
	              ></a-entity>
			  </a-box>

              <a-entity class="scene" id="scene3"  visible="false">
                <a-entity
                  gltf-model='#s3' scale=".5 .5 .5" animation-mixer rotation="90 0 0">
                </a-entity>
                <a-entity position= "0 2.75 .8" scale="1.5 1 1">
                  <a-video autoplay="true" id="laptop_video" src="#s3_video"></a-video>
                </a-entity>
              </a-entity>
          </a-marker>
          <a-marker preset="custom" type="pattern" url="/markers/4.patt">
			<a-box class="gift" position='0 0.5 0' scale="2 2 2" material='opacity: 0;' start-animation='name: scene4; length: 29000'>
              <a-entity 
                gltf-model='#gift_4'
              	scale="0.25 0.25 0.25"
              	position='0 -0.5 0'
              >
              </a-entity>
          	</a-box>
              <a-entity class="scene" id='scene4'
                gltf-model='#s4'
                animation-mixer
                visible="false"
                scale="0.666 0.666 0.666"
                rotation='90 0 0'
              >
              </a-entity>
          </a-marker>
          <a-marker preset="custom" type="pattern" url="/markers/6.patt">
              <a-box class="gift" position='0 0.5 0' scale="2 2 2" material='opacity: 0;' start-animation='name: scene6; length: 34000'>
	              <a-entity
	                gltf-model='#gift_6'
	              	scale="0.25 0.25 0.25"
	              	position='0 -0.5 0'
	              >
	              </a-entity>
          	  </a-box>
              <a-entity class="scene" id='scene6'
                gltf-model='#s6'
                animation-mixer
                rotation='90 0 0'
                scale="0.666 0.666 0.666"
                visible="false"
              >
              </a-entity>
          </a-marker>
          <a-marker preset="custom" type="pattern" url="/markers/11.patt">
			  <a-box class="gift" position='0 0.5 0' scale="1.5 1.5 1.5" material='opacity: 0;' start-animation='name: scene11; length: 5000; selfie: true'>
	              <a-entity
	                gltf-model='#gift_11'
	              	scale="0.25 0.25 0.25"
	              	position='0 -0.5 0'
	              >
	              </a-entity>
          	  </a-box>
              <a-entity class="scene" id='scene11'
                
                scale="0.666 0.666 0.666"
                visible="false"
              >
                <a-entity
                gltf-model='#s11'
                animation-mixer
                rotation='90 0 0'></a-entity>
                <a-entity
                gltf-model='#s11_phone'
                animation-mixer
                position='0 0 3'
                rotation='0 0 0'></a-entity>
              </a-entity>
          </a-marker>

          <!-- <a-entity id="selfie_frame" visible="false" geometry="primitive:plane;" position='0 0 -2' scale=".7725 1.6 1" material="shader:gif;src:url(/graphics/SantaSelfieRepaired.gif);" gif="" autoplay="true"></a-entity> -->
          <a-entity camera cursor="rayOrigin: mouse; fuse: true" raycaster="objects: a-box">
          </a-entity>
        </a-scene>
        <script>
var progress = 0;
    function loadProgress(percent) {
      var el = document.getElementById("xload__bar_progress")
      if (progress <= 100) {
        progress += percent
        el.style.width = progress.toString()+ "%"
      }
    }
    document.getElementById('gift_1').addEventListener('loaded', function() { 
      console.log("Gift 1 loaded") 
      loadProgress(10)
    })
    document.getElementById('gift_3').addEventListener('loaded', function() { console.log("Gift 3 loaded")
    loadProgress(10) })
    document.getElementById('gift_4').addEventListener('loaded', function() { console.log("Gift 4 loaded")
    loadProgress(10) })
    document.getElementById('gift_6').addEventListener('loaded', function() { console.log("Gift 6 loaded")
    loadProgress(10) })
    document.getElementById('gift_11').addEventListener('loaded', function() { console.log("Gift 11 loaded")
    loadProgress(10) })
    document.getElementById('s1').addEventListener('loaded', function() { console.log("s 1 loaded")
    loadProgress(8) })
    document.getElementById('s3').addEventListener('loaded', function() { console.log("s 3 loaded")
    loadProgress(8) })
    document.getElementById('s4').addEventListener('loaded', function() { console.log("s 4 loaded")
    loadProgress(8) })
    document.getElementById('s6').addEventListener('loaded', function() { console.log("s 6 loaded")
    loadProgress(8) })
    document.getElementById('s11').addEventListener('loaded', function() { console.log("s 11 loaded")
    loadProgress(8) })
</script> 
    </body>
</html>